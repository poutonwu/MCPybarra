# MCP Server Implementation Plan: Local Outlook Automation

## 1. Server Overview

This plan outlines the creation of an MCP server designed to automate and manage a local installation of Microsoft Outlook. The server will provide a set of tools to list email folders, retrieve and search for emails within specific timeframes, view detailed email content, and compose or reply to emails. All interactions with Outlook will be handled via the `win32com` library, and the server will maintain a temporary cache of listed emails to allow for easy referencing by number.

## 2. File to be Generated

All the server logic, including the Outlook interaction module and the MCP tool definitions, will be contained within a single Python file:

*   `mcp_outlook_server.py`

## 3. Dependencies

The following Python libraries are required for the server to function correctly:

*   `mcp`: For creating the MCP server and defining tools.
*   `pywin32`: To provide the `win32com.client` module necessary for interfacing with the local Outlook application.

## 4. MCP Tools Plan

### Tool 1: `list_folders`

*   **Function Name**: `list_folders`
*   **Description**: Retrieves and lists all accessible email folders from the user's main Outlook mailbox. This includes the inbox, sent items, drafts, and any custom folders.
*   **Parameters**: None.
*   **Return Value**: A JSON string representing a list of folder names.
    *   **Type**: `str`
    *   **Example**: `["Inbox", "Sent Items", "Drafts", "My Project Folder"]`

### Tool 2: `list_recent_emails`

*   **Function Name**: `list_recent_emails`
*   **Description**: Fetches a list of email subjects from a specified folder received within a given number of days. The results are cached, and each email is assigned a number for subsequent operations.
*   **Parameters**:
    *   `days` (int): The number of past days to search for emails. Must be a positive integer.
    *   `folder_name` (str, optional): The name of the Outlook folder to search in. If not provided, it defaults to "Inbox".
*   **Return Value**: A JSON string representing a list of dictionaries, where each dictionary contains the assigned number and the subject of an email. Returns an empty list if no emails are found.
    *   **Type**: `str`
    *   **Example**: `[{"number": 1, "subject": "Project Update"}, {"number": 2, "subject": "Meeting Reminder"}]`

### Tool 3: `search_emails`

*   **Function Name**: `search_emails`
*   **Description**: Searches for emails based on a keyword or a contact's name within a specified date range and folder. The results are cached, and each email is assigned a number.
*   **Parameters**:
    *   `query` (str): The keyword or contact name to search for in the subject, body, or sender/recipient fields.
    *   `start_date` (str): The start date for the search range, formatted as 'YYYY-MM-DD'.
    *   `end_date` (str): The end date for the search range, formatted as 'YYYY-MM-DD'.
    *   `folder_name` (str, optional): The name of the folder to search. Defaults to "Inbox".
*   **Return Value**: A JSON string representing a list of dictionaries, each containing the assigned number and the subject of a matching email. Returns an empty list if no matches are found.
    *   **Type**: `str`
    *   **Example**: `[{"number": 1, "subject": "Re: Project Plan"}, {"number": 2, "subject": "Fwd: Important Document"}]`

### Tool 4: `get_email_by_number`

*   **Function Name**: `get_email_by_number`
*   **Description**: Retrieves the full details of a specific email from the most recent list generated by `list_recent_emails` or `search_emails`, using its assigned number.
*   **Parameters**:
    *   `email_number` (int): The number of the email as provided in the last list.
*   **Return Value**: A JSON string representing a dictionary with the email's details, including sender, recipients (To, CC), subject, body, and a list of attachment filenames. Returns an error message if the number is invalid.
    *   **Type**: `str`
    *   **Example**: `{"from": "sender@example.com", "to": "you@example.com", "cc": "manager@example.com", "subject": "Project Update", "body": "Here is the latest update...", "attachments": ["report.docx", "data.xlsx"]}`

### Tool 5: `reply_to_email_by_number`

*   **Function Name**: `reply_to_email_by_number`
*   **Description**: Sends a reply to a specific email from the cached list using its assigned number.
*   **Parameters**:
    *   `email_number` (int): The number of the email to reply to.
    *   `reply_body` (str): The content of the reply message.
*   **Return Value**: A string indicating the result of the operation.
    *   **Type**: `str`
    *   **Example**: `"Successfully replied to email number 1."` or `"Error: Invalid email number 99."`

### Tool 6: `compose_email`

*   **Function Name**: `compose_email`
*   **Description**: Composes and sends a new email with the specified subject, body, and recipients.
*   **Parameters**:
    *   `subject` (str): The subject line of the new email.
    *   `body` (str): The main content of the email.
    *   `recipients` (list[str]): A list of email addresses for the 'To' field.
    *   `cc_recipients` (list[str], optional): A list of email addresses for the 'CC' field. Defaults to an empty list.
*   **Return Value**: A string confirming that the email was sent successfully.
    *   **Type**: `str`
    *   **Example**: `"Email with subject 'New Proposal' sent successfully."`